{% extends 'base.html' %}
{% block content %}

<!-- Article Page Start -->
<div class="container-fluid py-5 bg-light">
    <div class="container">

        <!-- Breadcrumb -->
        <ol class="breadcrumb bg-transparent px-0 mb-4">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Bosh sahifa</a></li>
            <li class="breadcrumb-item"><a href="#">{{ article.category.name }}</a></li>
            <li class="breadcrumb-item active text-dark">{{ article.title }}</li>
        </ol>

        <div class="row justify-content-center">
            <div class="col-lg-10">

                <!-- Title -->
                <h1 class="display-6 fw-bold mb-3">{{ article.title }}</h1>

                <!-- Meta -->
                <div class="d-flex flex-wrap text-muted mb-4 small">
                    <span class="me-3"><i class="fa fa-clock me-1"></i>{{ article.read_time }} o'qiladi</span>
                    <span class="me-3"><i class="fa fa-eye me-1"></i>{{ article.views }} ko'rildi</span>
                    <span class="me-3"><i class="fa fa-comment me-1"></i>{{ article.comments.count }} izoh</span>
                    <span><i class="fa fa-calendar me-1"></i>{{ article.created_at|date:"d.m.Y H:i" }}</span>
                </div>

                <!-- Cover -->
                {% if article.cover %}
                <div class="mb-4 rounded overflow-hidden">
                    <img src="{{ article.cover.url }}"
                         class="img-fluid w-100"
                         style="max-height:460px; object-fit:cover;"
                         alt="{{ article.title }}">
                </div>
                {% endif %}

                <!-- Intro -->
                <div class="fs-5 text-dark mb-4 lh-lg">
                    {{ article.intro }}
                </div>

                <!-- Article Body -->
                <div class="article-body">

                    {% for context in article.context.all %}

                        {% if context.text %}
                        <div class="mb-4 fs-5 lh-lg text-dark">
                            {{ context.text|linebreaks }}
                        </div>
                        {% endif %}

                        {% if context.image %}
                        <div class="mb-4 text-center">
                            <img src="{{ context.image.url }}"
                                 class="img-fluid rounded"
                                 style="max-height:420px; object-fit:contain; background:#f8f9fa;"
                                 alt="">
                        </div>
                        {% endif %}

                    {% endfor %}

                    {% if not article.intro and not article.context.all %}
                    <div class="alert alert-secondary">
                        Maqola matni tayyorlanmoqda.
                    </div>
                    {% endif %}
                </div>

                <!-- Article End Marker -->
                <div class="text-center text-muted my-5">
                    <i class="fa fa-minus"></i> Maqola yakunlandi <i class="fa fa-minus"></i>
                </div>

                <!-- Tags & Share -->
                <div class="d-flex flex-wrap justify-content-between align-items-center border-top pt-4 mb-5">
                    <div class="d-flex flex-wrap align-items-center">
                        <strong class="me-2">Taglar:</strong>
                        {% for tag in article.tags.all %}
                        <span class="badge bg-secondary me-2 mb-2">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                    <div>
                        <i class="fab fa-facebook-f me-3 text-muted"></i>
                        <i class="fab fa-twitter me-3 text-muted"></i>
                        <i class="fab fa-instagram me-3 text-muted"></i>
                        <i class="fab fa-linkedin text-muted"></i>
                    </div>
                </div>

                <!-- Related Articles -->
                <div class="bg-white rounded p-4 mb-5">
                    <h4 class="mb-4">Shu kabi yangiliklar</h4>
                    <div class="row g-4">
                        {% for a in like_articles %}
                        <div class="col-md-6">
                            <div class="d-flex align-items-center">
                                <img src="{{ a.cover.url }}"
                                     class="rounded"
                                     style="width:120px; height:80px; object-fit:cover;"
                                     alt="{{ a.title }}">
                                <div class="ms-3">
                                    <a href="{% url 'article-details' a.slug %}"
                                       class="fw-semibold text-dark d-block mb-1">
                                        {{ a.title|truncatechars:60 }}
                                    </a>
                                    <small class="text-muted">
                                        <i class="fa fa-clock me-1"></i>{{ a.read_time }} o'qiladi
                                    </small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Comments -->
                <div class="bg-white rounded p-4 mb-5">
                    <h4 class="mb-4">Izohlar ({{ article.comments.count }})</h4>

                    {% for comment in comments %}
                    <div class="border-bottom pb-4 mb-4">
                        <div class="d-flex">
                            <img src="/static/img/user.png"
                                 class="rounded-circle me-3"
                                 style="width:48px;"
                                 alt="">
                            <div>
                                <strong>{{ comment.name|default:"Anonymous" }}</strong>
                                <small class="text-muted d-block mb-2">
                                    {{ comment.created_at|date:"d.m.Y H:i" }}
                                </small>
                                <p class="mb-0 text-secondary">
                                    {{ comment.text|linebreaks }}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted text-center">Hozircha izohlar yoâ€˜q.</p>
                    {% endfor %}
                </div>

                <!-- Comment Form -->
                <div class="bg-white rounded p-4">
                    <h4 class="mb-4">Izoh qoldiring</h4>
                    <form method="post">
                        {% csrf_token %}
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="text" name="name" class="form-control" placeholder="Ismingiz" required>
                            </div>
                            <div class="col-md-6">
                                <input type="email" name="email" class="form-control" placeholder="Email" required>
                            </div>
                            <div class="col-12">
                                <textarea name="text" rows="4" class="form-control" placeholder="Izohingiz..." required></textarea>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary w-100">
                                    <i class="fa fa-paper-plane me-2"></i>Yuborish
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>
<!-- Article Page End -->

{% endblock %}
